- name: Installing Remo repo 
  command: dnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm
  args:  
    warn: no
    creates: /etc/yum.repos.d/remi-safe.repo


- name: Checking Remo repo
  shell:
    cmd: dnf -C repolist enabled -v  | grep '^Repo-id' | awk '$3 == "remi-safe" {print "enabled"}'
    warn: false 
  check_mode: no
  changed_when: false
  register: remi_repo


- import_tasks: clean_php.yml
  when: reinstall_php | default('false')


- name: Installing System PHP
  dnf:
    name: "{{ php_packages }}"
    enablerepo: "php:remi-{{ system_php }}"
    state: latest
  when: remi_repo.stdout == 'enabled'


- name: Installing Secondary PHP
  dnf:
    name: "{{ secondary_php_packages }}"
    state: latest
  when: item.install
  loop: "{{ secondary_php }}"  


- import_tasks: configs.yml
